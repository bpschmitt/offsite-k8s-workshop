<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.3.0"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><title data-react-helmet="true">New Relic Kubernetes Workshop</title><meta data-react-helmet="true" name="description" content="A Kubernetes Workshop with a New Relic focus"/><meta data-react-helmet="true" name="image" content="https://bpschmitt.github.io/offsite-k8s-workshop/nrlogo.png"/><meta data-react-helmet="true" http-equiv="x-ua-compatible" content="IE=edge,chrome=1"/><meta data-react-helmet="true" name="MobileOptimized" content="320"/><meta data-react-helmet="true" name="HandheldFriendly" content="True"/><meta data-react-helmet="true" name="google" content="notranslate"/><meta data-react-helmet="true" name="referrer" content="no-referrer-when-downgrade"/><meta data-react-helmet="true" property="og:url" content="https://bpschmitt.github.io/offsite-k8s-workshop/exercises/06_ohis_hpa/"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:title" content="New Relic Kubernetes Workshop"/><meta data-react-helmet="true" property="og:description" content="A Kubernetes Workshop with a New Relic focus"/><meta data-react-helmet="true" property="og:locale" content="en"/><meta data-react-helmet="true" property="og:site_name" content="New Relic Kubernetes Workshop"/><meta data-react-helmet="true" property="og:image" content="https://bpschmitt.github.io/offsite-k8s-workshop/nrlogo.png"/><meta data-react-helmet="true" property="og:image:secure_url" content="https://bpschmitt.github.io/offsite-k8s-workshop/nrlogo.png"/><meta data-react-helmet="true" property="og:image:alt" content="Banner"/><meta data-react-helmet="true" property="og:image:type" content="image/png"/><meta data-react-helmet="true" property="og:image:width" content="1200"/><meta data-react-helmet="true" property="og:image:height" content="630"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="New Relic Kubernetes Workshop"/><meta data-react-helmet="true" name="twitter:site" content="@bpschmitt"/><meta data-react-helmet="true" name="twitter:creator" content="@bpschmitt"/><meta data-react-helmet="true" name="twitter:image" content="https://bpschmitt.github.io/offsite-k8s-workshop/nrlogo.png"/><meta data-react-helmet="true" name="twitter:image:src" content="https://bpschmitt.github.io/offsite-k8s-workshop/nrlogo.png"/><meta data-react-helmet="true" name="twitter:image:alt" content="Banner"/><meta data-react-helmet="true" name="twitter:image:width" content="1200"/><meta data-react-helmet="true" name="twitter:image:height" content="630"/><script data-react-helmet="true" type="application/ld+json">[{"@context":"http://schema.org","@type":"WebSite","url":"https://bpschmitt.github.io/offsite-k8s-workshop/exercises/06_ohis_hpa/","name":"","alternateName":"New Relic Kubernetes Workshop"}]</script><link rel="icon" href="/offsite-k8s-workshop/favicon-32x32.png?v=7c7bc0e8bbaa89a8a362db10b3e4be7e" type="image/png"/><link rel="manifest" href="/offsite-k8s-workshop/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/offsite-k8s-workshop/icons/icon-48x48.png?v=7c7bc0e8bbaa89a8a362db10b3e4be7e"/><link rel="apple-touch-icon" sizes="72x72" href="/offsite-k8s-workshop/icons/icon-72x72.png?v=7c7bc0e8bbaa89a8a362db10b3e4be7e"/><link rel="apple-touch-icon" sizes="96x96" href="/offsite-k8s-workshop/icons/icon-96x96.png?v=7c7bc0e8bbaa89a8a362db10b3e4be7e"/><link rel="apple-touch-icon" sizes="144x144" href="/offsite-k8s-workshop/icons/icon-144x144.png?v=7c7bc0e8bbaa89a8a362db10b3e4be7e"/><link rel="apple-touch-icon" sizes="192x192" href="/offsite-k8s-workshop/icons/icon-192x192.png?v=7c7bc0e8bbaa89a8a362db10b3e4be7e"/><link rel="apple-touch-icon" sizes="256x256" href="/offsite-k8s-workshop/icons/icon-256x256.png?v=7c7bc0e8bbaa89a8a362db10b3e4be7e"/><link rel="apple-touch-icon" sizes="384x384" href="/offsite-k8s-workshop/icons/icon-384x384.png?v=7c7bc0e8bbaa89a8a362db10b3e4be7e"/><link rel="apple-touch-icon" sizes="512x512" href="/offsite-k8s-workshop/icons/icon-512x512.png?v=7c7bc0e8bbaa89a8a362db10b3e4be7e"/><link rel="sitemap" type="application/xml" href="/offsite-k8s-workshop/sitemap/sitemap-index.xml"/><link rel="canonical" href="https://rocketdocs.netlify.app/exercises/06_ohis_hpa" data-baseprotocol="https:" data-basehost="rocketdocs.netlify.app"/><link as="script" rel="preload" href="/offsite-k8s-workshop/webpack-runtime-89a6a25cb0fc62e6bd29.js"/><link as="script" rel="preload" href="/offsite-k8s-workshop/framework-02fced52a07adb2a1d39.js"/><link as="script" rel="preload" href="/offsite-k8s-workshop/f0e45107-549a615315530a229048.js"/><link as="script" rel="preload" href="/offsite-k8s-workshop/app-418b7134cdb8dc38d233.js"/><link as="script" rel="preload" href="/offsite-k8s-workshop/545f34e4-fbdf3371245ae9449b10.js"/><link as="script" rel="preload" href="/offsite-k8s-workshop/5e2a4920-2606368e26af31faa706.js"/><link as="script" rel="preload" href="/offsite-k8s-workshop/252f366e-a548eb79488bf3cc69f0.js"/><link as="script" rel="preload" href="/offsite-k8s-workshop/a7629950cb7a18c7593baf47d0acfe798f1cddc4-72066251f04050af0537.js"/><link as="script" rel="preload" href="/offsite-k8s-workshop/component---node-modules-rocketseat-gatsby-theme-docs-core-src-templates-docs-query-js-d32088f68da6ce3864c2.js"/><link as="fetch" rel="preload" href="/offsite-k8s-workshop/page-data/exercises/06_ohis_hpa/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/offsite-k8s-workshop/page-data/sq/d/1954253342.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/offsite-k8s-workshop/page-data/sq/d/2328931024.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/offsite-k8s-workshop/page-data/sq/d/2501019404.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/offsite-k8s-workshop/page-data/sq/d/973074209.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/offsite-k8s-workshop/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><style data-emotion="css-global 1rqv44b">*,*::after,*::before{margin:0;padding:0;box-sizing:border-box;}body{font-size:16px;font-family:Futura;background-color:#FFFFFF;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased;overflow-y:scroll;}h1{font-size:32px;color:#3D3D4D;font-weight:bold;margin-bottom:24px;}h2{font-size:24px;}h3{font-size:18px;}h4{font-size:16px;}h2,h3,h4,h5,h6{color:#3D3D4D;margin:24px 0 16px 0;font-weight:bold;}p{color:#6C6C80;font-size:16px;line-height:28px;margin-bottom:16px;font-weight:400;}code.inline-code{display:inline-block;vertical-align:middle;line-height:1;padding:0.2em;background-color:#44475a;color:rgba(248, 248, 242);font-size:14px;border-radius:3px;font-feature-settings:'clig' 0,'calt' 0;font-variant:no-common-ligatures no-discretionary-ligatures no-historical-ligatures no-contextual;}h1 code.inline-code,h2 code.inline-code{font-size:calc(100% - 5px);padding:4px;}a{color:#6C6C80;font-weight:bold;-webkit-text-decoration:none;text-decoration:none;}a:hover{-webkit-text-decoration:underline;text-decoration:underline;}blockquote{margin-bottom:16px;width:100%;}blockquote p{padding:1rem;border-radius:5px;background:#e9e9e9;color:#E1E1E6;margin:0;}blockquote p a{color:#E1E1E6;}hr{border:0;height:0;border-top:1px solid rgba(0, 0, 0, 0.1);border-bottom:1px solid rgba(255, 255, 255, 0.3);}table{border-collapse:separate;border-spacing:0 4px;margin-top:-4px;margin-bottom:16px;width:100%;}table th,table td{margin:0;color:#6C6C80;background-color:#F2F2FA;border:solid 1px #F2F2FA;border-style:solid none;padding:12px;}table th:first-of-type,table td:first-of-type{border-left-style:solid;border-top-left-radius:5px;border-bottom-left-radius:5px;}table th:last-child,table td:last-child{border-right-style:solid;border-bottom-right-radius:5px;border-top-right-radius:5px;}table tr th{color:#3D3D4D;text-align:left;font-weight:bold;}iframe{margin-bottom:16px;}img{max-width:100%;}ul,ol{color:#6C6C80;padding-left:15px;margin-bottom:16px;}ul li,ol li{line-height:28px;}li ul,li ol{margin-bottom:0;}.gatsby-highlight{font-family:Hack,SFMono-Regular,Menlo,Monaco,Consolas,'Liberation Mono','Courier New',monospace;font-variant:no-common-ligatures no-discretionary-ligatures no-historical-ligatures no-contextual;position:relative;z-index:0;margin:0 0 16px 0;overflow:auto;}.gatsby-highlight .token{font-style:normal!important;}pre[class*='language-'] code{font-family:inherit;}pre[class*='language-']::before{background:#d9d7e0;border-radius:0 0 4px 4px;color:#232129;font-size:12px;font-family:inherit;letter-spacing:0.075em;line-height:1;padding:0.25rem 0.5rem;position:absolute;left:1rem;text-align:right;text-transform:uppercase;top:0;}pre[class~='language-js']::before,pre[class~='language-javascript']::before{content:'js';background:#f7df1e;}pre[class~='language-jsx']::before{content:'jsx';background:#61dafb;}pre[class~='language-typescript']::before,pre[class~='language-ts']::before{content:'ts';background:#294e80;color:#fff;}pre[class~='language-tsx']::before{content:'tsx';background:#294e80;color:#fff;}pre[class~='language-graphql']::before{content:'GraphQL';background:#e10098;color:#fff;}pre[class~='language-html']::before{content:'html';background:#005a9c;color:#fff;}pre[class~='language-css']::before{content:'css';background:#ff9800;color:#fff;}pre[class~='language-mdx']::before{content:'mdx';background:#f9ac00;color:#fff;}pre[class~='language-shell']::before{content:'shell';}pre[class~='language-sh']::before{content:'sh';}pre[class~='language-bash']::before{content:'bash';}pre[class~='language-yaml']::before,pre[class~='language-yml']::before{content:'yaml';background:#ffa8df;}pre[class~='language-markdown']::before{content:'md';}pre[class~='language-json']::before,pre[class~='language-json5']::before{content:'json';background:linen;}pre[class~='language-diff']::before{content:'diff';background:#e6ffed;}pre[class~='language-text']::before{content:'text';background:#fff;}pre[class~='language-flow']::before{content:'flow';background:#e8bd36;}</style><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css d43d92">.css-d43d92::after{content:'';position:fixed;width:100%;height:100%;left:0;right:0;bottom:0;background-color:rgba(0, 0, 0, 0.8);z-index:999;display:none;}</style><div aria-label="Close menu" class="css-d43d92"></div><style data-emotion="css 1kjnnqm">.css-1kjnnqm{width:100%;max-width:1400px;margin:0 auto;padding:0 24px;display:grid;grid-template-columns:280px calc(100% - 320px);grid-auto-flow:row;grid-gap:40px;}@media (max-width: 780px){.css-1kjnnqm{padding:24px;grid-template-columns:100%;}}</style><div class="css-1kjnnqm eees1d52"><style data-emotion="css 9tjo13">.css-9tjo13{width:100%;overflow-y:auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;position:-webkit-sticky;position:sticky;top:0;padding-top:36px;-webkit-transition:-webkit-transform 0.5s;transition:transform 0.5s;height:calc(100vh - 1px);}.css-9tjo13 nav{width:100%;padding-top:24px;-webkit-align-self:flex-start;-ms-flex-item-align:flex-start;align-self:flex-start;-webkit-flex:1;-ms-flex:1;flex:1;}@media (max-width: 780px){.css-9tjo13{max-width:75%;min-width:auto;z-index:1001;position:fixed;top:0;bottom:0;left:0;padding-top:32px;background:#FFFFFF;-webkit-transform:translate3d(
      -100%,
      0,
      0
    );-moz-transform:translate3d(
      -100%,
      0,
      0
    );-ms-transform:translate3d(
      -100%,
      0,
      0
    );transform:translate3d(
      -100%,
      0,
      0
    );}}</style><aside class="css-9tjo13 e1wh78ri5"><style data-emotion="css 2yrou">.css-2yrou{width:100%;}.css-2yrou a{width:100%;padding-left:30px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-2yrou e1wh78ri4"><a aria-label="Go to home page" href="/offsite-k8s-workshop/"><img src="/offsite-k8s-workshop/static/nrlogo2-0dcad078e0767145aa56249192a23a31.png" alt="New Relic Logo" style="width:180px"/></a></div><nav><style data-emotion="css qmhqz9">.css-qmhqz9{list-style:none;width:100%;padding-left:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}</style><ul class="css-qmhqz9 e1wh78ri3"><style data-emotion="css 9fbhnm">.css-9fbhnm{font-size:15px;width:100%;-webkit-transition:all 200ms ease-in-out;transition:all 200ms ease-in-out;padding:0 20px;cursor:pointer;}.css-9fbhnm a,.css-9fbhnm span{display:block;font-size:15px;color:#6C6C80;background-color:#FFFFFF;padding:4px 10px;margin:4px 0;border-radius:4px;font-weight:normal;-webkit-text-decoration:none;text-decoration:none;width:100%;height:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;cursor:pointer;margin:0 auto;-webkit-transition:all 0.2s ease;transition:all 0.2s ease;}.css-9fbhnm a svg,.css-9fbhnm span svg{width:20px;height:20px;margin-right:10px;}.css-9fbhnm a:not(.active-link):hover,.css-9fbhnm span:not(.active-link):hover{color:#70CCD3;}.css-9fbhnm a.active-link,.css-9fbhnm span.active-link{color:#70CCD3;background-color:#F2F2FA;}@media (max-width: 780px){.css-9fbhnm a.active-link,.css-9fbhnm span.active-link{background:#F2F2FA;}}</style><li class="css-9fbhnm e1wh78ri1"><a href="/offsite-k8s-workshop/getting-started">Getting started</a></li><style data-emotion="css mximbs">.css-mximbs{padding-left:30px;width:100%;text-transform:uppercase;font-size:14px;font-weight:bold;margin-top:20px;color:#3D3D4D;letter-spacing:0.142em;}</style><li class="css-mximbs e1wh78ri2">Exercises</li><style data-emotion="css 1cgn8l4">.css-1cgn8l4{list-style:none;width:100%;padding-left:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;margin:5px 0 0 0;}</style><ul class="css-1cgn8l4 e1wh78ri0"><li class="css-9fbhnm e1wh78ri1"><a href="/offsite-k8s-workshop/exercises/01_kubernetes_basics">Kubernetes Basics</a></li><li class="css-9fbhnm e1wh78ri1"><a href="/offsite-k8s-workshop/exercises/02_deploy_apps">Deploy Apps</a></li><li class="css-9fbhnm e1wh78ri1"><a href="/offsite-k8s-workshop/exercises/03_troubleshooting">Troubleshooting</a></li><li class="css-9fbhnm e1wh78ri1"><a href="/offsite-k8s-workshop/exercises/04_helm">Helm</a></li><li class="css-9fbhnm e1wh78ri1"><a href="/offsite-k8s-workshop/exercises/05_pomi">Promethus OpenMetrics Integration</a></li><li class="css-9fbhnm e1wh78ri1"><a aria-current="page" class="active-link" href="/offsite-k8s-workshop/exercises/06_ohis_hpa">OHIs and HPA</a></li><li class="css-9fbhnm e1wh78ri1"><a href="/offsite-k8s-workshop/exercises/07_logging">Logging</a></li></ul><li class="css-mximbs e1wh78ri2">More</li><ul class="css-1cgn8l4 e1wh78ri0"><li class="css-9fbhnm e1wh78ri1"><a href="/offsite-k8s-workshop/faq">FAQ</a></li><li class="css-9fbhnm e1wh78ri1"><a href="https://github.com/bpschmitt/offsite-k8s-workshop" rel="noopener noreferrer">Github<svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px;margin-left:10px" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></li></ul></ul></nav></aside><style data-emotion="css u8hwp7">.css-u8hwp7{height:100%;padding-top:36px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;position:relative;}@media (max-width: 1200px){.css-u8hwp7{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}@media (max-width: 780px){.css-u8hwp7{padding-top:0;}}</style><main class="css-u8hwp7 eees1d51"><style data-emotion="css 1p24zom">.css-1p24zom{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:40px;margin-bottom:24px;}.css-1p24zom h2{margin:0;border:none;padding:0;font-size:18px;}@media (max-width: 359px){.css-1p24zom h2{font-size:14px;}}.css-1p24zom button{border:none;background:none;cursor:pointer;margin-right:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}@media (min-width: 780px){.css-1p24zom{display:none;}}</style><header class="css-1p24zom esnpb7p0"><button aria-label="Open sidebar" type="button"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" aria-hidden="true" height="23" width="23" xmlns="http://www.w3.org/2000/svg"><path d="M32 96v64h448V96H32zm0 128v64h448v-64H32zm0 128v64h448v-64H32z"></path></svg></button><h2>New Relic Kubernetes Workshop</h2></header><style data-emotion="css 1h97cat">.css-1h97cat{width:100%;max-width:calc(75% - 64px);padding-right:64px;}@media (max-width: 1200px){.css-1h97cat{max-width:100%;padding-right:0;-webkit-order:3;-ms-flex-order:3;order:3;}}.css-1h97cat h1,.css-1h97cat h2,.css-1h97cat h3,.css-1h97cat h4,.css-1h97cat h5,.css-1h97cat h6{overflow-wrap:break-word;}</style><div class="css-1h97cat eees1d50"><h2 id="06-on-host-integrations-ohis-and-horizontal-pod-autoscaling-hpa" style="position:relative"><a href="#06-on-host-integrations-ohis-and-horizontal-pod-autoscaling-hpa" aria-label="06 on host integrations ohis and horizontal pod autoscaling hpa permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>06. On-Host Integrations (OHIs) and Horizontal Pod Autoscaling (HPA)</h2><p>In this module, you will:</p><ul><li>Configure the NGINX OHI to auto-discover NGINX instances running in the cluster</li><li>Enable the custom metrics adapter for HPA and configured a custom metric (<code class="inline-code">nginx_average_requests</code> for auto-scaling)</li><li>Create the <code class="inline-code">nginx-scaler</code> HPA resource</li><li>Generate load to the <code class="inline-code">nginx</code> service in order to trigger the auto-scaling process</li></ul><p><strong>Reading</strong>:</p><ul><li>Learn about the <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/">Horizontal Pod Autoscaler</a></li><li>Learn about options when running <a href="https://helm.sh/docs/helm/helm_upgrade/">helm upgrade</a></li><li>NGINX OHI config <a href="https://github.com/newrelic/nri-nginx/blob/master/nginx-config.yml.k8s_sample">examples</a></li></ul><hr/><p>New Relic&#x27;s On-Host Integrations use <a href="https://github.com/newrelic/nri-discovery-kubernetes">Kubernetes service auto-discovery</a> to identify available 3rd party services running in the cluster.  All supported OHIs are shipped with the New Relic Infrastructure agent in a Kubernetes cluster.  All you need to do is provided a valid configuration when you install the <code class="inline-code">newrelic-infrastructure</code> subchart.</p><h2 id="enabling-the-nginx-ohi" style="position:relative"><a href="#enabling-the-nginx-ohi" aria-label="enabling the nginx ohi permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Enabling the NGINX OHI</h2><p>In the <code class="inline-code">values.yaml</code> file found in this directory, you&#x27;ll see a section of the config called <code class="inline-code">newrelic-infrastructure</code>.  Any configuration options defined in this section are passed down to the the <code class="inline-code">newrelic-infrastructure</code> subchart from <code class="inline-code">nri-bundle</code>.  Uncomment the <code class="inline-code">newrelic-infrastructure</code> section and everything nested underneath it.</p><p>A few things to call out:</p><ul><li><code class="inline-code">name</code> - this is the integration file name that will reside in <code class="inline-code">/etc/newrelic-infra/integrations.d</code> inside each New Relic Infrastructure container.</li><li><code class="inline-code">nri-discovery-kubernetes</code> - this is used to auto-discover the services in the cluster matching the label <code class="inline-code">app: nginx</code>.</li><li><code class="inline-code">integrations</code> - this is where you configure the integration details.  Note that the variable <code class="inline-code">${discovery.ip}</code> is used in the NGINX status page URL.  This is dynamic for every instance that matches the <code class="inline-code">app: nginx</code> label.</li></ul><div class="gatsby-highlight"><style data-emotion="css 36wvs0">.css-36wvs0{text-align:left;padding:1rem 1rem 1rem 1rem;overflow:auto;white-space:pre;word-spacing:normal;word-break:normal;border-radius:5px;-webkit-overflow-scrolling:touch;overflow-wrap:break-word;box-shadow:1px 1px 20px rgba(20, 20, 20, 0.27);}.css-36wvs0 code{float:left;min-width:100%;padding-right:1rem;}.css-36wvs0 .token-line{line-height:22px;font-size:14px;min-width:100%;}.css-36wvs0 .highlight-line{background-color:#44475a;margin-left:-1rem;margin-right:-2rem;padding:0 0.75rem;border-left:4px solid #70CCD3;}</style><pre class="prism-code language- css-36wvs0 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><style data-emotion="css 1k3nmwp">.css-1k3nmwp{position:absolute;top:0;right:0;z-index:1;border-radius:0 5px 0 5px;padding:0.25rem 0.6rem;border:none;cursor:pointer;background:#44475a;color:rgb(248, 248, 242);-webkit-transition:all 200ms ease;transition:all 200ms ease;font-size:12px;}.css-1k3nmwp:disabled{cursor:not-allowed;}.css-1k3nmwp:not(:disabled):hover,.css-1k3nmwp:not(:disabled):focus{background:#70CCD3;}</style><button class="css-1k3nmwp eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">newrelic-infrastructure:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  integrations_config:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    - name: nri-nginx.yaml</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      data:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        discovery:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">          command:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            # Use the following optional arguments:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            # --namespaces: Comma separated list of namespaces to discover pods on</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            # --tls: Use secure (TLS) connection</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            # --port: Port used to connect to the kubelet. Default is 10255</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            exec: /var/db/newrelic-infra/nri-discovery-kubernetes</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            match:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">              label.app: nginx</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        integrations:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">          - name: nri-nginx</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            env:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">              # If you&#x27;re using ngx_http_api_module be certain to use the full path up to and including the version number</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">              # Use the discovered IP as the host address</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">              STATUS_URL: http://${discovery.ip}/nginx_status</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">              # Name of Nginx status module OHI is to query against. discover | ngx_http_stub_status_module | ngx_http_status_module | ngx_http_api_module</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">              STATUS_MODULE: discover</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">              METRICS: 1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">              REMOTE_MONITORING: 1</span></div></code></pre></div><h2 id="custom-metrics-adapter-for-horizontal-pod-autoscaling" style="position:relative"><a href="#custom-metrics-adapter-for-horizontal-pod-autoscaling" aria-label="custom metrics adapter for horizontal pod autoscaling permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Custom Metrics Adapter for Horizontal Pod Autoscaling</h2><p><a href="https://github.com/newrelic/helm-charts/tree/master/charts/newrelic-k8s-metrics-adapter">New Relic&#x27;s Kubernetes Metric Adapter</a> enables developers to scale their deployments using the Kubernetes <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/">Horizontal Pod Autoscaler</a>.  Imagine needing to dynamically scale your services to support an increase in throughput during your biggest day?  With the metric adapter, you can now query New Relic using NRQL and use the value returned for evaluation within HPA.</p><p><img src="https://docs.newrelic.com/550f34a8085779979e628c68bc885d1a/adapter-diagram.svg" alt="Image"/></p><p>In the <code class="inline-code">values.yaml</code> file in this directory, uncomment the <code class="inline-code">newrelic-k8s-metrics-adapter</code> section and everything nested underneath it.  You&#x27;ll need to provide the following:</p><ul><li><code class="inline-code">personalAPIKey</code> - this is NOT a license key.  This is a User API key.</li><li><code class="inline-code">accountID</code> - this is the New Relic Account ID to query.</li></ul><p>The metric adapter uses the <a href="https://docs.newrelic.com/docs/apis/nerdgraph/get-started/introduction-new-relic-nerdgraph/">Nerdgraph API</a> to query New Relic using NRQL.  In the example, you&#x27;ll be creating a custom metric to be stored in Kubernetes called <code class="inline-code">nginx_average_requests</code> and the value for this metric will be the result of the supplied NRQL query.</p><div class="gatsby-highlight"><pre class="prism-code language- css-36wvs0 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1k3nmwp eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">newrelic-k8s-metrics-adapter:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  personalAPIKey: &lt;REDACTED&gt;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  config:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    accountID: &lt;REDACTED&gt;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    externalMetrics:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      nginx_average_requests:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        query: &quot;from Metric select average(nginx.server.net.requestsPerSecond) since 2 minutes ago&quot;</span></div></code></pre></div><h2 id="upgrading-the-newrelic-bundle-helm-release" style="position:relative"><a href="#upgrading-the-newrelic-bundle-helm-release" aria-label="upgrading the newrelic bundle helm release permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Upgrading the <code class="inline-code">newrelic-bundle</code> Helm release</h2><p>Now that you&#x27;ve modified your <code class="inline-code">values.yaml</code> for both the NGINX OHI and the metrics adapter, it&#x27;s time to upgrade the <code class="inline-code">newrelic-bundle</code> release with the new configuration.</p><p>You&#x27;ll notice this command is a lot shorter than the original one from the Guided Install UI.  That&#x27;s because you&#x27;re upgrading an existing release and you&#x27;ve moved all configuration to a <code class="inline-code">values.yaml</code> file. A couple new options are being used for the <a href="https://helm.sh/docs/helm/helm_upgrade/">helm upgrade</a>:</p><ul><li><code class="inline-code">--reuse-values</code> - when upgrading, reuse the last release&#x27;s values and merge in any overrides from the command line via <code class="inline-code">--set</code> and <code class="inline-code">-f</code>.</li><li><code class="inline-code">-f</code> - specify values in a YAML file or a URL (can specify multiple)</li></ul><div class="gatsby-highlight"><pre class="prism-code language- css-36wvs0 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1k3nmwp eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ helm upgrade newrelic-bundle newrelic/nri-bundle -n newrelic --reuse-values -f ./values.yaml</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Release &quot;newrelic-bundle&quot; has been upgraded. Happy Helming!</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">NAME: newrelic-bundle</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">LAST DEPLOYED: Tue Nov  9 21:46:03 2021</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">NAMESPACE: newrelic</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">STATUS: deployed</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">REVISION: 7</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">TEST SUITE: None</span></div></code></pre></div><p>You can run a quick validation using NRQL that the NGINX OHI has been configured successfully.  You should see rows returned in query builder.</p><div class="gatsby-highlight"><pre class="prism-code language- css-36wvs0 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1k3nmwp eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">FROM NginxSample select podName, net.connectionsActive where clusterName = &#x27;minikube-workshop&#x27;</span></div></code></pre></div><h2 id="create-nginx-scaler-hpa-resource" style="position:relative"><a href="#create-nginx-scaler-hpa-resource" aria-label="create nginx scaler hpa resource permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create <code class="inline-code">nginx-scaler</code> HPA resource</h2><p>Congrats! You&#x27;ve configured the NGINX OHI and the custom metrics adapter.  Now it&#x27;s time to create the HPA resource in your cluster so that your NGINX deployment will autoscale based on metric data that exists in New Relic.</p><p>Let&#x27;s take a look at the <code class="inline-code">hpa.yaml</code> file.  In this file, you&#x27;re creating a custom metric called <code class="inline-code">nginx_average_requests</code> which is created and stored in Kubernetes.  Kubernetes will auto-scale the <code class="inline-code">nginx</code> deployment up or down so that the value returned by the NRQL query is below the <code class="inline-code">target.value</code> of <code class="inline-code">2</code>.</p><div class="gatsby-highlight"><pre class="prism-code language- css-36wvs0 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1k3nmwp eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">kind: HorizontalPodAutoscaler</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">apiVersion: autoscaling/v2beta2</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">metadata:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  name: nginx-scaler</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  namespace: demo</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">spec:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  scaleTargetRef:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    apiVersion: apps/v1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    kind: Deployment</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    name: nginx</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  minReplicas: 1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  maxReplicas: 10</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  metrics:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    - type: External</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      external:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        metric:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">          name: nginx_average_requests</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">          selector:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            matchLabels:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">              k8s.namespaceName: demo</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        target:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">          type: Value</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">          value: 2</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  behavior:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    scaleDown:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      stabilizationWindowSeconds: 90</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    scaleUp:</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      stabilizationWindowSeconds: 90</span></div></code></pre></div><p>You can query the Kubernetes API directly to see the values being evaluated.</p><div class="gatsby-highlight"><pre class="prism-code language- css-36wvs0 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1k3nmwp eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get --raw &quot;/apis/external.metrics.k8s.io/v1beta1/namespaces/*/nginx_average_requests?labelSelector=k8s.namespaceName=demo&quot;</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">{&quot;kind&quot;:&quot;ExternalMetricValueList&quot;,&quot;apiVersion&quot;:&quot;external.metrics.k8s.io/v1beta1&quot;,&quot;metadata&quot;:{},&quot;items&quot;:[{&quot;metricName&quot;:&quot;nginx_average_requests&quot;,&quot;metricLabels&quot;:{},&quot;timestamp&quot;:&quot;2021-11-10T04:25:00Z&quot;,&quot;value&quot;:&quot;33333u&quot;}]}</span></div></code></pre></div><p>Run the following command to create the HPA resource in your cluster.</p><div class="gatsby-highlight"><pre class="prism-code language- css-36wvs0 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1k3nmwp eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl apply -f hpa.yaml -n demo</span></div></code></pre></div><p>Validate that it was created and note the existing values under the <code class="inline-code">TARGETS</code> section.  Kubernetes uses <code class="inline-code">milliunits</code> so you&#x27;ll see strange numbers like <code class="inline-code">3400m</code> show up here.  For illustration purposes, this means <code class="inline-code">3400 / 1000 = 3.4</code>.</p><p>Keep this command handy, you&#x27;ll come back to it.</p><div class="gatsby-highlight"><pre class="prism-code language- css-36wvs0 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1k3nmwp eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get hpa nginx-scaler -n demo</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">NAME           REFERENCE          TARGETS   MINPODS   MAXPODS   REPLICAS   AGE</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">nginx-scaler   Deployment/nginx   34m/2     1         10        1          15m</span></div></code></pre></div><h2 id="generate-load" style="position:relative"><a href="#generate-load" aria-label="generate load permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Generate Load</h2><p>Now that you&#x27;ve configured the NGINX OHI, configured the metrics adapter, and created the HPA resource - it&#x27;s time to watch the magic happen.  Use the command below to create a load generation pod in your cluster which will hit the <code class="inline-code">nginx</code> service endpoint with a bunch of curl commands.</p><div class="gatsby-highlight"><pre class="prism-code language- css-36wvs0 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1k3nmwp eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl apply -f loadgen.yaml -n demo</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">pod/load-gen created</span></div></code></pre></div><p>Immediately after starting your load gen, run this command to watch the <code class="inline-code">nginx-scaler</code> HPA resource as it scales up your <code class="inline-code">nginx</code> deployment.</p><div class="gatsby-highlight"><pre class="prism-code language- css-36wvs0 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1k3nmwp eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">$ kubectl get hpa -n demo -w</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">NAME           REFERENCE          TARGETS   MINPODS   MAXPODS   REPLICAS   AGE</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">nginx-scaler   Deployment/nginx   34m/2     1         10        1          40m</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">nginx-scaler   Deployment/nginx   192m/2    1         10        1          40m</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">nginx-scaler   Deployment/nginx   1367m/2   1         10        1          40m</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">nginx-scaler   Deployment/nginx   2534m/2   1         10        1          41m</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">nginx-scaler   Deployment/nginx   3709m/2   1         10        1          41m</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">nginx-scaler   Deployment/nginx   4717m/2   1         10        1          42m</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">nginx-scaler   Deployment/nginx   4717m/2   1         10        2          42m</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">nginx-scaler   Deployment/nginx   4209m/2   1         10        2          43m</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">nginx-scaler   Deployment/nginx   4209m/2   1         10        2          43m</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">nginx-scaler   Deployment/nginx   2467m/2   1         10        3          44m</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">nginx-scaler   Deployment/nginx   2467m/2   1         10        4          44m</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">nginx-scaler   Deployment/nginx   1880m/2   1         10        4          44m</span></div></code></pre></div><p>You can watch this process visually by creating a multi-query chart in New Relic&#x27;s query builder with the following NRQL queries:</p><div class="gatsby-highlight"><pre class="prism-code language- css-36wvs0 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1k3nmwp eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">from Metric select average(nginx.server.net.requestsPerSecond) where k8s.namespaceName = &#x27;demo&#x27; since 30 minutes ago TIMESERIES 30 seconds</span></div></code></pre></div><div class="gatsby-highlight"><pre class="prism-code language- css-36wvs0 eiqe2b57" style="color:#F8F8F2;background-color:#282A36"><button class="css-1k3nmwp eiqe2b50">Copy</button><code><div class="token-line" style="color:#F8F8F2"><span class="token plain">FROM K8sPodSample select uniqueCount(podName) as &#x27;Pod Count&#x27; where podName like &#x27;nginx%&#x27; since 30 minutes ago TIMESERIES 30 seconds</span></div></code></pre></div><p>Here you can see as the average throughput increases, HPA kicks in and scales the deployment until the average throughput is below the target value of 2.</p><p><img src="https://p191.p3.n0.cdn.getcloudapp.com/items/DOu6mbWZ/68c68579-6c95-4940-8a88-923c2f607bb9.jpg?v=8db29e4462645dc093dbc5f445752972" alt="Autoscale"/></p><h2 id="conclusion" style="position:relative"><a href="#conclusion" aria-label="conclusion permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h2><p>In this module, you completed the following:</p><ul><li>Configured the NGINX OHI to auto-discover NGINX instances running in the cluster</li><li>Enabled the custom metrics adapter for HPA and configured a custom metric (<code class="inline-code">nginx_average_requests</code> for auto-scaling)</li><li>Created the <code class="inline-code">nginx-scaler</code> HPA resource</li><li>Generated load to the <code class="inline-code">nginx</code> service in order to trigger the auto-scaling process</li></ul><style data-emotion="css 1vvt293">.css-1vvt293{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;margin-top:48px;color:#6C6C80;opacity:0.8;font-size:14px;font-weight:normal;}</style><a href="https://github.com/jpedroschmitz/rocketdocs/tree/main/examples/gatsby-theme-docs/src/docs/exercises/06_ohis_hpa.mdx" target="_blank" rel="noopener noreferrer" class="css-1vvt293"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" style="margin-right:5px" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a.996.996 0 000-1.41l-2.34-2.34a.996.996 0 00-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"></path></svg>Edit this page on <!-- -->GitHub</a><style data-emotion="css ns1hxi">.css-ns1hxi{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:48px 0;width:100%;}@media (max-width: 780px){.css-ns1hxi{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><section class="css-ns1hxi e1jikabl1"><style data-emotion="css 94m8q6">.css-94m8q6{-webkit-transition:all 200ms;transition:all 200ms;}.css-94m8q6 a{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-text-decoration:none;text-decoration:none;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;height:100%;}.css-94m8q6 a svg{width:25px;height:25px;color:#6C6C80;margin-right:16px;}.css-94m8q6 a p{letter-spacing:0.142em;text-transform:uppercase;font-size:12px;margin:0;color:#6C6C80;}.css-94m8q6 a h3{color:#6C6C80;border:none;margin:0;padding:0;font-size:16px;}.css-94m8q6:hover{opacity:0.8;}.css-94m8q6:hover a svg{opacity:0.8;}@media (max-width: 780px){.css-94m8q6{width:100%;margin-bottom:16px;}.css-94m8q6 a{-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;}}</style><div class="css-94m8q6 e1jikabl0"><a href="/offsite-k8s-workshop/exercises/05_pomi"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"></path></svg><div><p>Prev</p><h3>Promethus OpenMetrics Integration</h3></div></a></div><style data-emotion="css 10sjsqn">.css-10sjsqn{-webkit-transition:all 200ms;transition:all 200ms;margin-left:auto;}.css-10sjsqn a{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-text-decoration:none;text-decoration:none;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;height:100%;}.css-10sjsqn a svg{width:25px;height:25px;color:#6C6C80;margin-left:16px;}.css-10sjsqn a p{letter-spacing:0.142em;text-transform:uppercase;font-size:12px;margin:0;color:#6C6C80;}.css-10sjsqn a h3{color:#6C6C80;border:none;margin:0;padding:0;font-size:16px;}.css-10sjsqn:hover{opacity:0.8;}.css-10sjsqn:hover a svg{opacity:0.8;}@media (max-width: 780px){.css-10sjsqn{width:100%;}.css-10sjsqn a{-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;}}</style><div class="css-10sjsqn e1jikabl0"><a href="/offsite-k8s-workshop/exercises/07_logging"><div><p>Next</p><h3>Logging</h3></div><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"></path></svg></a></div></section></div><style data-emotion="css 106zi9a">.css-106zi9a{position:-webkit-sticky;position:sticky;top:0;-webkit-order:2;-ms-flex-order:2;order:2;padding-top:72px;max-height:calc(100vh - 72px);overflow-y:auto;overflow-x:hidden;width:100%;max-width:200px;}@media (max-width: 1200px){.css-106zi9a{position:relative;top:auto;-webkit-order:0;-ms-flex-order:0;order:0;max-width:100%;margin-left:0;padding-top:0;}}</style><div class="css-106zi9a e10o0eax1"><style data-emotion="css 1gnn5iw">.css-1gnn5iw h2{text-transform:uppercase;font-size:14px;font-weight:bold;letter-spacing:0.142em;margin-top:0rem;border:none;margin:0 0 16px 0;}.css-1gnn5iw nav ul{padding-left:0;margin-bottom:0;list-style:none;}.css-1gnn5iw nav ul li{margin-bottom:12px;line-height:1.1;}.css-1gnn5iw nav ul li a{font-size:14px;font-weight:400;-webkit-text-decoration:none;text-decoration:none;-webkit-transition:all 0.2s;transition:all 0.2s;overflow-wrap:break-word;}.css-1gnn5iw nav ul li a:hover{-webkit-text-decoration:underline;text-decoration:underline;}@media (max-width: 1200px){.css-1gnn5iw{margin:0 0 24px 0;padding-bottom:16px;border-bottom:1px solid rgba(120, 117, 122, 0.2);}}</style><div class="css-1gnn5iw e10o0eax0"><h2>On this page</h2><nav><ul><li><a href="#06-on-host-integrations-ohis-and-horizontal-pod-autoscaling-hpa" style="color:#6C6C80">06. On-Host Integrations (OHIs) and Horizontal Pod Autoscaling (HPA)</a></li><li><a href="#enabling-the-nginx-ohi" style="color:#6C6C80">Enabling the NGINX OHI</a></li><li><a href="#custom-metrics-adapter-for-horizontal-pod-autoscaling" style="color:#6C6C80">Custom Metrics Adapter for Horizontal Pod Autoscaling</a></li><li><a href="#upgrading-the-newrelic-bundle-helm-release" style="color:#6C6C80">Upgrading the newrelic-bundle Helm release</a></li><li><a href="#create-nginx-scaler-hpa-resource" style="color:#6C6C80">Create nginx-scaler HPA resource</a></li><li><a href="#generate-load" style="color:#6C6C80">Generate Load</a></li><li><a href="#conclusion" style="color:#6C6C80">Conclusion</a></li></ul></nav></div></div></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/exercises/06_ohis_hpa";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-75eb2c57e0c70628df3c.js"],"app":["/app-418b7134cdb8dc38d233.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-21b69de1969e8cd9185e.js"],"component---node-modules-rocketseat-gatsby-theme-docs-core-src-templates-docs-query-js":["/component---node-modules-rocketseat-gatsby-theme-docs-core-src-templates-docs-query-js-d32088f68da6ce3864c2.js"],"component---node-modules-rocketseat-gatsby-theme-docs-core-src-templates-homepage-query-js":["/component---node-modules-rocketseat-gatsby-theme-docs-core-src-templates-homepage-query-js-e952e9ab345d1a67424e.js"],"component---src-pages-404-js":["/component---src-pages-404-js-72629df109c36f9bb718.js"]};/*]]>*/</script><script src="/offsite-k8s-workshop/polyfill-75eb2c57e0c70628df3c.js" nomodule=""></script><script src="/offsite-k8s-workshop/component---node-modules-rocketseat-gatsby-theme-docs-core-src-templates-docs-query-js-d32088f68da6ce3864c2.js" async=""></script><script src="/offsite-k8s-workshop/a7629950cb7a18c7593baf47d0acfe798f1cddc4-72066251f04050af0537.js" async=""></script><script src="/offsite-k8s-workshop/252f366e-a548eb79488bf3cc69f0.js" async=""></script><script src="/offsite-k8s-workshop/5e2a4920-2606368e26af31faa706.js" async=""></script><script src="/offsite-k8s-workshop/545f34e4-fbdf3371245ae9449b10.js" async=""></script><script src="/offsite-k8s-workshop/app-418b7134cdb8dc38d233.js" async=""></script><script src="/offsite-k8s-workshop/f0e45107-549a615315530a229048.js" async=""></script><script src="/offsite-k8s-workshop/framework-02fced52a07adb2a1d39.js" async=""></script><script src="/offsite-k8s-workshop/webpack-runtime-89a6a25cb0fc62e6bd29.js" async=""></script></body></html>